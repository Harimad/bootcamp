<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Vending Machine</title>
	<!-- BootStrap css cdn -->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
	<!-- fontawesome cdn -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css"
		integrity="sha512-1sCRPdkRXhBV2PBLUdRb4tMg1w2YPf37qatUFeS7zlBy7jJI8Lf4VHwWfZZfpXtYSLy85pkm9GaYVYMfw5BC1A=="
		crossorigin="anonymous" referrerpolicy="no-referrer" />
	<style>
		.container {
			background-color: #EEE;
		}

		.btn {
			width: 160px;
			height: 150px;
			font-size: 18px;
			font-weight: bold;
		}

	</style>
</head>

<body>
	<div class="container mt-3 p-3">
		<div id="inventory">
			<div class="row text-center align-items-center justify-content-center mt-3 mb-3">
				<div class="col-3">
					<button class="coke btn btn-outline-info" data-class="coke" data-value="700" data-num="0">Coke<br>(700원, 재고수:
						<span id="coke">5</span>)</but>
				</div>
				<div class="col-3">
					<button class="orange btn btn-outline-info" data-class="orange" data-value="1200"
						data-num="1">Orange<br>(1200원, 재고수: <span id="orange">5</span>)</button>
				</div>
				<div class="col-3">
					<button class="coffee btn btn-outline-info" data-class="coffee" data-value="500" data-num="2">Coffee<br>(500원,
						재고수: <span id="coffee">5</span>)</button>
				</div>
			</div>
			<div class="row align-items-center justify-content-center mt-3">
				<div class="col-3">
					<button class="water btn btn-outline-info" data-class="water" data-value="700" data-num="3">Water<br>(700원,
						재고수: <span id="water">5</span>)</button>
				</div>
				<div class="col-3">
					<button class="tea btn btn-outline-info" data-class="tea" data-value="1200" data-num="4">Tea<br>(1200원, 재고수:
						<span id="tea">5</span>)</button>
				</div>
				<div class="col-3">
					<button class="milkiss btn btn-outline-info" data-class="milkiss" data-value="700"
						data-num="5">Milkiss<br>(700원, 재고수: <span id="milkiss">5</span>)</button>
				</div>
				<div class="col-3">
					<button class="trevi btn btn-outline-info" data-class="trevi" data-value="1000" data-num="6">Trevi<br>(1000원,
						재고수: <span id="trevi">5</span>)</button>
				</div>
			</div>
		</div>
		<hr>
		<div class="pocket row">
			<div class="col-4">
				<label for="insert" class="form-label">자판기에 저장된 금액: </label>
				<input type="text" id="insert" class="insert form-control" value="0" readonly></input>
			</div>
			<div class="col-4">
				<label for="total" class="form-label">투입금액: </label>
				<input type="text" id="total" class="total form-control" value="0" readonly></input>
			</div>
			<div class="col-4">
				<label for="leftMoney" class="form-label">내지갑: </label>
				<input type="text" id="leftMoney" class="leftMoney form-control" readonly></input>
			</div>
		</div>
		<hr>
		<div id="coinInsert" class="text-center">
			<button id="hundred" class="btn btn-secondary" data-value="100">100원 투입</button>
			<button id="fiveHundred" class="btn btn-success" data-value="500">500원 투입</button>
			<button id="thousand" class="btn btn-dark" data-value="1000">1000원 투입</button>
			<button id="return" class="btn btn-outline-danger">거스름돈 반환</button>
		</div>
		<hr>
		<div class="result text-center">
			<h3>Message</h3>
			<p>자판기에는 총 <span class="insert">0</span>원이 있습니다.</p>
			<p>총 투입 금액은 <span class="total">0</span>원 입니다.</p>
			<p>당신의 지갑에는 <span class="leftMoney">10000</span>원이 남아 있습니다.</p>
		</div>
	</div>
	<!-- BootStrap JS cdn -->
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa"
		crossorigin="anonymous"></script>
	<script>
		const $ = tag => document.querySelector(tag);
		const $$ = tag => document.querySelectorAll(tag);

		const $coinInsert = $('#coinInsert');
		const $hundred = $('#hundred');
		const $fiveHundred = $('#fiveHundred');
		const $thousand = $('#thousand');
		const $$insert = $$('.insert');
		const $$total = $$('.total');
		const $$leftMoney = $$('.leftMoney');
		const $return = $('#return');

		const $inventory = $('#inventory');
		const $coke = $('#coke');
		const $orange = $('#orange');
		const $coffee = $('#coffee');
		const $water = $('#water');
		const $tea = $('#tea');
		const $milkiss = $('#milkiss');
		const $trevi = $('#trevi');

		// const drinkLists = ['coke', 'orange', 'coffee', 'water', 'tea', 'milkiss', 'trevi'];
		const leftDrink = [
			{ coke: Number($coke.innerText) },
			{ orange: Number($orange.innerText) },
			{ coffee: Number($coffee.innerText) },
			{ water: Number($water.innerText) },
			{ tea: Number($tea.innerText) },
			{ milkiss: Number($milkiss.innerText) },
			{ trevi: Number($trevi.innerText) },
		]

		let insertedMoney = 0;
		let totalMoney = 10000;
		$$leftMoney[0].value = totalMoney;

		let machineHas = 0;
		$$insert[0].value = machineHas;
		$$insert[1].innerText = machineHas;

		function renderLeftDrink() {
			$coke.innerText = leftDrink[0]['coke'];
			$orange.innerText = leftDrink[1]['orange'];
			$coffee.innerText = leftDrink[2]['coffee'];
			$water.innerText = leftDrink[3]['water'];
			$tea.innerText = leftDrink[4]['tea'];
			$milkiss.innerText = leftDrink[5]['milkiss'];
			$trevi.innerText = leftDrink[6]['trevi'];
		}

		$coinInsert.addEventListener('click', event => {
			if (totalMoney >= 100) {

				let dataSetValue = Number(event.target.dataset.value);

				if (!!dataSetValue) {
					// console.log('데이터셋 있음!');
					if (totalMoney >= dataSetValue) {
						//돈 증가
						insertedMoney += dataSetValue;
						$$total[0].value = insertedMoney;
						$$total[1].innerText = insertedMoney;

						//돈 차감
						totalMoney -= dataSetValue;
						$$leftMoney[0].value = totalMoney
						$$leftMoney[1].innerText = totalMoney;
					} else {
						return;
					}
				} else {
					return;
				}
				console.log(`insetedMoney: ${insertedMoney}, totalMoney: ${totalMoney}`);
			} else {
				return alert('투입할 돈이 없습니다.')
			}
		})

		$inventory.addEventListener('click', event => {
			// console.log(event.target.className)
			// console.dir(event.target)
			let dataSetValue = Number(event.target.dataset.value);
			let dataSetNum = Number(event.target.dataset.num);
			let dataClass = event.target.dataset.class;
			// console.log(dataSetValue);
			// console.log(dataSetNum, dataClass);

			if (!!dataSetValue) {
				//투입금액이 음료보다 더 커야 & 재고수가 1개 이상 있어야 실행
				if (leftDrink[dataSetNum][dataClass] > 0) {
					if (insertedMoney >= dataSetValue) {
						//투입금액 차감
						insertedMoney -= dataSetValue;
						$$total[0].value = insertedMoney;
						$$total[1].innerText = insertedMoney;

						//재고수 차감
						leftDrink[dataSetNum][dataClass] -= 1;

						// 음료 재고 재랜더링
						renderLeftDrink();
						console.log(leftDrink);

						//음료자판기 저장 금액 증가
						machineHas += dataSetValue;
						$$insert[0].value = machineHas;
						$$insert[1].innerText = machineHas;
					} else {
						return alert('금액이 부족합니다.')
					}
				} else {
					return alert('재고가 부족합니다');
				}
			} else {
				return;
			}
		});

		$return.addEventListener('click', event => {
			if (insertedMoney >= 100) {
				totalMoney += insertedMoney;
				insertedMoney = 0;

				// 자판기, Message에서 투입금액 새로고침
				$$total[0].value = insertedMoney;
				$$total[1].innerText = insertedMoney;
				// 자판기, Message에서 내지갑 새로고침
				$$leftMoney[0].value = totalMoney;
				$$leftMoney[1].innerText = totalMoney;
			} else {
				return alert('반환할 돈이 없습니다.')
			}
		})

	</script>
</body>

</html>
