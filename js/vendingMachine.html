<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Vending Machine</title>
	<!-- BootStrap css cdn -->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
	<!-- fontawesome cdn -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css"
		integrity="sha512-1sCRPdkRXhBV2PBLUdRb4tMg1w2YPf37qatUFeS7zlBy7jJI8Lf4VHwWfZZfpXtYSLy85pkm9GaYVYMfw5BC1A=="
		crossorigin="anonymous" referrerpolicy="no-referrer" />
	<style>
		* {
			margin: 0;
			padding: 0;
		}

		.container {
			background-color: #c2eafc;
			border-radius: 20px;
			max-width: 1000px;
		}

		.btn {
			width: 100%;
			font-size: 18px;
			font-weight: bold;
		}

		#inventory {
			border: 3px solid black;
			padding: 1.5rem;
			border-radius: 5px;
			background-color: #eee;
		}

		.drinkImg {
			width: 100px;
			height: 100px;
		}

	</style>
</head>

<body>
	<div class="container p-3">
		<div id="inventory" class="text-center">
			<div class=" row justify-content-center mb-3 gy-1">
				<div class="col-sm-4">
					<button class="coke btn btn-outline-dark" data-class="coke" data-value="700" data-num="0">
						<img class="drinkImg" src="./img/coke.jpg" data-class="coke" data-value="700" data-num="0">
						<hr>
						Coke 700￦<br>재고: <span id="coke">5</span>
					</button>
				</div>
				<div class="col-sm-4">
					<button class="orange btn btn-outline-dark" data-class="orange" data-value="1200" data-num="1">
						<img class="drinkImg" src="./img/orangeJuice.jpg" data-class="orange" data-value="1200" data-num="1">
						<hr>
						Orange 1200￦<br>재고: <span id="orange">5</span>
					</button>
				</div>
				<div class="col-sm-4">
					<button class="coffee btn btn-outline-dark" data-class="coffee" data-value="500" data-num="2">
						<img class="drinkImg" src="./img/coffee.jpg" data-class="coffee" data-value="500" data-num="2">
						<hr>
						Coffee 500￦<br>재고: <span id="coffee">5</span>
					</button>
				</div>
			</div>
			<div class="row justify-content-around align-items-center me-2 gy-1">
				<div class="col-sm-6 col-md-3">
					<button class="water btn btn-outline-dark" data-class="water" data-value="700" data-num="3">
						<img class="drinkImg" src="./img/water.jpg" data-class="water" data-value="700" data-num="3">
						<hr>
						Water 700￦<br>재고: <span id="water">5</span>
					</button>
				</div>
				<div class="col-sm-6 col-md-3">
					<button class="tea btn btn-outline-dark" data-class="tea" data-value="1200" data-num="4">
						<img class="drinkImg" src="./img/tea.jpg" data-class="tea" data-value="1200" data-num="4">
						<hr>
						Tea 1200￦<br>재고:<span id="tea">5</span>
						</img>
					</button>
				</div>
				<div class="col-sm-6 col-md-3">
					<button class="milkiss btn btn-outline-dark" data-class="milkiss" data-value="700" data-num="5">
						<img class="drinkImg" src="./img/millkiss.jpg" data-class="milkiss" data-value="700" data-num="5">
						<hr>
						Milkiss 700￦<br>재고: <span id="milkiss">5</span>
					</button>
				</div>
				<div class="col-sm-6 col-md-3">
					<button class="trevi btn btn-outline-dark" data-class="trevi" data-value="1000" data-num="6">
						<img class="drinkImg" src="./img/trevi.png" data-class="trevi" data-value="1000" data-num="6">
						<hr>
						Trevi 1000￦<br>재고: <span id="trevi">5</span>
					</button>
				</div>
			</div>
		</div>
		<hr>
		<div class="pocket row gy-1">
			<div class="col-sm-6 col-md-4">
				<label for="insert" class="form-label">자판기에 저장된 금액: </label>
				<input type="text" id="insert" class="insert form-control" value="0" readonly></input>
			</div>
			<div class="col-sm-6 col-md-4">
				<label for="total" class="form-label">투입금액: </label>
				<input type="text" id="total" class="total form-control" value="0" readonly></input>
			</div>
			<div class="col-sm-6 col-md-4">
				<label for="leftMoney" class="form-label">내지갑: </label>
				<input type="text" id="leftMoney" class="leftMoney form-control" readonly></input>
			</div>
		</div>
		<hr>
		<div id="coinInsert" class="text-center row justify-content-center gy-2">
			<div class="col-sm-6 col-md-3">
				<button id="hundred" class="btn btn-info" data-value="100">100원 투입</button>
			</div>
			<div class="col-sm-6 col-md-3">
				<button id="fiveHundred" class="btn btn-warning" data-value="500">500원 투입</button>
			</div>
			<div class="col-sm-6 col-md-3">
				<button id="thousand" class="btn btn-success" data-value="1000">1000원 투입</button>
			</div>
		</div>
		<div class="row justify-content-center mt-2">
			<div class="col-sm-6 col-md-3">
				<button id="return" class="btn btn-outline-danger">거스름돈 반환</button>
			</div>
		</div>
		<hr>
		<div class="result text-center">
			<h3>Message</h3>
			<p>자판기에는 총 <span class="insert">0</span>원이 있습니다.</p>
			<p>총 투입 금액은 <span class="total">0</span>원 입니다.</p>
			<p>당신의 지갑에는 <span class="leftMoney">10000</span>원이 남아 있습니다.</p>
		</div>
	</div>
	<!-- sweetHeart2 JS cdn -->
	<script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
	<!-- BootStrap JS cdn -->
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa"
		crossorigin="anonymous"></script>
	<script>
		const $ = tag => document.querySelector(tag);
		const $$ = tag => document.querySelectorAll(tag);

		const $coinInsert = $('#coinInsert');
		const $hundred = $('#hundred');
		const $fiveHundred = $('#fiveHundred');
		const $thousand = $('#thousand');
		const $$insert = $$('.insert');
		const $$total = $$('.total');
		const $$leftMoney = $$('.leftMoney');
		const $return = $('#return');

		const $inventory = $('#inventory');
		const $coke = $('#coke');
		const $orange = $('#orange');
		const $coffee = $('#coffee');
		const $water = $('#water');
		const $tea = $('#tea');
		const $milkiss = $('#milkiss');
		const $trevi = $('#trevi');

		const drinkLists = ['coke', 'orange', 'coffee', 'water', 'tea', 'milkiss', 'trevi'];
		const leftDrink = [
			{ coke: Number($coke.innerText) },
			{ orange: Number($orange.innerText) },
			{ coffee: Number($coffee.innerText) },
			{ water: Number($water.innerText) },
			{ tea: Number($tea.innerText) },
			{ milkiss: Number($milkiss.innerText) },
			{ trevi: Number($trevi.innerText) },
		]

		let insertedMoney = 0;
		let totalMoney = 10000;
		$$leftMoney[0].value = totalMoney;

		let machineHas = 0;
		$$insert[0].value = machineHas;
		$$insert[1].innerText = machineHas;

		function renderLeftDrink() {
			$coke.innerText = leftDrink[0]['coke'];
			$orange.innerText = leftDrink[1]['orange'];
			$coffee.innerText = leftDrink[2]['coffee'];
			$water.innerText = leftDrink[3]['water'];
			$tea.innerText = leftDrink[4]['tea'];
			$milkiss.innerText = leftDrink[5]['milkiss'];
			$trevi.innerText = leftDrink[6]['trevi'];
		}

		$coinInsert.addEventListener('click', event => {
			if (totalMoney >= 100) {
				let dataSetValue = Number(event.target.dataset.value);

				if (!!dataSetValue) {
					// console.log('데이터셋 있음!');
					if (totalMoney >= dataSetValue) {
						//돈 증가
						insertedMoney += dataSetValue;
						$$total[0].value = insertedMoney;
						$$total[1].innerText = insertedMoney;
						changeColor(insertedMoney);
						checkLeftDrink()

						//돈 차감
						totalMoney -= dataSetValue;
						$$leftMoney[0].value = totalMoney
						$$leftMoney[1].innerText = totalMoney;
					} else {
						return;
					}
				} else {
					return;
				}
				console.log(`insetedMoney: ${insertedMoney}, totalMoney: ${totalMoney}`);
			} else {
				return showError('투입할 돈이 없습니다.')
			}
		})

		$inventory.addEventListener('click', event => {
			let dataSetValue = Number(event.target.dataset.value);
			let dataSetNum = Number(event.target.dataset.num);
			let dataClass = event.target.dataset.class;
			console.log(dataSetValue)

			if (!!dataSetValue) {
				//투입금액이 음료보다 더 커야 & 재고수가 1개 이상 있어야 실행
				if (leftDrink[dataSetNum][dataClass] > 0) {
					if (insertedMoney >= dataSetValue) {
						//투입금액 차감
						insertedMoney -= dataSetValue;
						$$total[0].value = insertedMoney;
						$$total[1].innerText = insertedMoney;

						//재고수 차감
						leftDrink[dataSetNum][dataClass] -= 1;

						// 음료 재랜더링
						renderLeftDrink();
						changeColor(insertedMoney);
						checkLeftDrink();

						//음료자판기 저장 금액 증가
						machineHas += dataSetValue;
						$$insert[0].value = machineHas;
						$$insert[1].innerText = machineHas;
					} else {
						return showError('금액이 부족합니다.')
					}
				} else {
					return showError('재고가 부족합니다');
				}
			} else {
				return;
			}
		});

		$return.addEventListener('click', event => {
			if (insertedMoney > 0) {
				totalMoney += insertedMoney;
				insertedMoney = 0;
				changeColor(insertedMoney)
				checkLeftDrink();

				// 자판기, Message에서 투입금액 새로고침
				$$total[0].value = insertedMoney;
				$$total[1].innerText = insertedMoney;
				// 자판기, Message에서 내지갑 새로고침
				$$leftMoney[0].value = totalMoney;
				$$leftMoney[1].innerText = totalMoney;
			} else {
				return showError('반환할 돈이 없습니다.')
			}
		})

		// (동전 넣을 때 마다 || 거스름돈 반활 할 때마다)
		// 삽입된 돈이 음료 값 이상이면 버튼 클래스를 btn-info 변경
		function changeColor(money) {
			// 처음엔 전부 일반테두리로 두름
			for (let i = 0; i < drinkLists.length; i++) {
				$(`.${drinkLists[i]}`).classList.remove('btn-info');
				$(`.${drinkLists[i]}`).classList.remove('btn-danger');
				$(`.${drinkLists[i]}`).classList.add('btn-outline-dark');
			}

			if (money >= 1200) {
				$('.orange').classList.remove('btn-outline-dark');
				$('.orange').classList.add('btn-info');
				$('.tea').classList.remove('btn-outline-dark');
				$('.tea').classList.add('btn-info');
			}
			if (money >= 1000) {
				$('.trevi').classList.remove('btn-outline-dark');
				$('.trevi').classList.add('btn-info');
			}
			if (money >= 700) {
				$('.coke').classList.remove('btn-outline-dark');
				$('.coke').classList.add('btn-info');
				$('.water').classList.remove('btn-outline-dark');
				$('.water').classList.add('btn-info');
				$('.milkiss').classList.remove('btn-outline-dark');
				$('.milkiss').classList.add('btn-info');
			}
			if (money >= 500) {
				$('.coffee').classList.remove('btn-outline-dark');
				$('.coffee').classList.add('btn-info');
			}
		}

		// 버튼을 눌러서 남은 음료의 개수 중에 0 에 도달하면
		// 버튼의 클래스를 btn-danger로 변경
		function checkLeftDrink() {
			for (const drink of leftDrink) {
				for (const key in drink) {
					if (drink[key] === 0) {
						$(`.${key}`).classList.remove('btn-info');
						$(`.${key}`).classList.remove('btn-oueline-dark');
						$(`.${key}`).classList.add('btn-danger');
					}
				}
			}
		}

		// sweetHeart2 에러창 날리는 함수
		function showError(text) {
			Swal.fire({
				icon: 'error',
				title: '알림',
				text: text,
			})
		}
	</script>
</body>

</html>
